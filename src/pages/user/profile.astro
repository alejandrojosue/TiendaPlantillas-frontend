---
import Sidebar from "../../components/Sidebar.astro";
import Layout from "../../layouts/Layout.astro";
import { Role } from "../../types/api";
import ByUserProjects from "../../components/project/ByUserProjects";
import UserRepository from "../../repositories/UserRepository";
import ByUserTemplates from "../../components/template/ByUserTemplates";

export const prerender = false;

const token = Astro.cookies.get("jwt")?.value as string;

if (!token) return Astro.redirect("/login");
const userRepository = new UserRepository();
const user = await userRepository.me({ token });
console.log({user});

if (!user) {
 Astro.response.status = 404;
 return;
}
let _role: any = user.role;
---

<Layout title="Profile">
 <div class="w-full flex flex-col lg:flex-row" slot="before-main">
  <Sidebar
   username={user.username ?? ""}
   isProfile={true}
   email={user.email ?? ""}
   role={_role === "Customer" ? "Cliente" : _role}
   githubLink={user.githubLink ?? ""}
   instagramLink={user.instagramLink ?? ""}
   LinkedInLink={user.LinkedInLink ?? ""}
  />
  <div class="w-full p-4">
   <h2 class="text-2xl">Mi Biografía</h2>
   <p class="text-gray-400 my-4">
    {user.biography ? user.biography : "// Nada aún"}
   </p>
   <h2 class="text-2xl mb-4">
    Mis {user.role && user.role === Role.customer ? "Proyectos" : "Plantillas"}
   </h2>
   <div>
    {
     user.role === Role.customer && (
      <ByUserProjects
       username={(user.username as string) ?? ""}
       client:visible
      />
     )
    }
    {
     user.role == Role.freelancer && (
      <ByUserTemplates
       username={(user.username as string) ?? ""}
       client:visible
      />
     )
    }
   </div>
  </div>
 </div>
</Layout>
